<div class="filters">
    <mat-form-field appearance="fill">
        <mat-label>Search (Name or Email)</mat-label>
        <input matInput [formControl]="searchControl" placeholder="Type to search" />
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Filter by Role</mat-label>
        <mat-select [formControl]="roleControl">
            <mat-option value="">All</mat-option>
            <mat-option *ngFor="let role of roles" [value]="role._id">{{ role.name }}</mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Filter by Status</mat-label>
        <mat-select [formControl]="statusControl">
            <mat-option value="">All</mat-option>
            <mat-option value="active">Active</mat-option>
            <mat-option value="blocked">Blocked</mat-option>
        </mat-select>
    </mat-form-field>

    <button (click)="createNewRole()">Create new Role</button>
</div>

<table mat-table [dataSource]="users" class="user-table mat-elevation-z2" matSort>

    <!-- Profile Column -->
    <ng-container matColumnDef="profile">
        <th mat-header-cell *matHeaderCellDef> Profile </th>
        <td mat-cell *matCellDef="let user">

            <div class="profile-info">
                <img *ngIf="profilePic(user)" [src]="profilePic(user)" class="profile-img" />
                <div *ngIf="!profilePic(user)" class="profile-img">
                    {{ user.email?.[0] | uppercase }}
                </div>
                <div class="user-details">
                    <div class="name">{{ user.name }}</div>
                    <div class="email">{{ user.email }}</div>
                </div>
            </div>
        </td>
    </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Name </th>
        <td mat-cell *matCellDef="let user"> {{ user.name }} </td>
    </ng-container>

    <!-- Email Column -->
    <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef> Email </th>
        <td mat-cell *matCellDef="let user"> {{ user.email }} </td>
    </ng-container>

    <!-- Role Column -->
    <ng-container matColumnDef="role">
        <th mat-header-cell *matHeaderCellDef> Role </th>
        <td mat-cell *matCellDef="let user">
            <mat-form-field appearance="fill" class="role-select">
                <mat-select [(ngModel)]="user.role" [compareWith]="compareRoles"
                    (selectionChange)="updateRole(user, $event.value)">
                    <mat-option *ngFor="let role of roles" [value]="role">{{ role.name }}</mat-option>
                </mat-select>
            </mat-form-field>
        </td>
    </ng-container>

    <!-- Block Column -->
    <ng-container matColumnDef="block">
        <th mat-header-cell *matHeaderCellDef> Status </th>
        <td mat-cell *matCellDef="let user">
            <mat-slide-toggle [checked]="user?.isBlocked" (change)="toggleBlock(user, $event.checked)" color="accent"
                [matTooltip]="user?.isBlocked == true ?  'Blocked' : 'Active'" matTooltipPosition="above">
            </mat-slide-toggle>
        </td>
    </ng-container>

    <!-- Header and Row Declarations -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>


</table>

<div *ngIf="users.length === 0" class="no-results">
    <p>üîç No results found</p>
    <small>Try changing filters or search query.</small>
</div>


<app-pagination [currentPage]="currentPage" [totalPages]="totalPages"
    (pageChanged)="onPageChange($event)">></app-pagination>